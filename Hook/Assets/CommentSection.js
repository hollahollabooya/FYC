// Generated by CoffeeScript 1.4.0
(function() {

  window.injectionScript = function(comments) {
    var decodeHTML, drawToScreen, pageSetup, populateComments, selectorSetup, setupUpdoots, suggestPost, verbose;
    verbose = true;
    if (verbose) {
      console.log('Main Script is being run');
    }
    if ($('#watch-discussion').length > 0 && verbose) {
      console.log('We found the youtube comments section');
    }
    pageSetup = function() {
      if (verbose) {
        console.log('pageSetup started...');
      }
      $('<div class="branded-page-box yt-card" id="comments-selector"><div id="reddit-select" class="selected">Reddit</div><div id="youtube-select">Youtube</div></div>').insertBefore('#watch-discussion');
      $('#watch-discussion').hide();
      $('<div class="branded-page-box yt-card" id="reddit-comments-card"></div>').insertAfter('#watch-discussion');
      if (verbose) {
        return console.log('pageSetup completed');
      }
    };
    selectorSetup = function() {
      $('#reddit-select').on("click", function() {
        $('#watch-discussion').hide();
        $('#reddit-comments-card').show();
        $('#reddit-select').addClass('selected');
        return $('#youtube-select').removeClass('selected');
      });
      if (verbose) {
        console.log('selectorSetup completed');
      }
      return $('#youtube-select').on("click", function() {
        $('#watch-discussion').show();
        $('#reddit-comments-card').hide();
        $('#reddit-select').removeClass('selected');
        return $('#youtube-select').addClass('selected');
      });
    };
    decodeHTML = function(encodedString) {
      var decoded;
      decoded = $('<div/>').html(encodedString).text();
      return SnuOwnd.getParser().render(decoded);
    };
    populateComments = function(comments, index) {
      var comment, commentHTML, _i, _len;
      if (verbose) {
        console.log('populateComments started...');
      }
      for (_i = 0, _len = comments.length; _i < _len; _i++) {
        comment = comments[_i];
        if (!(comment.user != null)) {
          continue;
        }
        if (comment.user === '[deleted]') {
          continue;
        }
        commentHTML = $("<div class=\"reddit-comment " + (index > 0 ? 'lesser' : void 0) + "\"></div>");
        $('#reddit-comments-card').append(commentHTML);
        commentHTML.append('<div class="reddit-comment-updoot"></div>');
        commentHTML.find('.reddit-comment-updoot').append("<div class=\"up\" style=\"background-image: url(" + (chrome.extension.getURL('/Assets/Images/reddit_icons.png')) + ");\"></div>");
        commentHTML.find('.reddit-comment-updoot').append("<span>" + comment.score + "</span>");
        commentHTML.find('.reddit-comment-updoot').append("<div class=\"down\" style=\"background-image: url(" + (chrome.extension.getURL('/Assets/Images/reddit_icons.png')) + ");\"></div>");
        commentHTML.append('<div class="comment-wrapper"></div>');
        commentHTML.find('.comment-wrapper').append('<div class="reddit-comment-user"></div>');
        commentHTML.find('.reddit-comment-user').append("<a href=\"http://www.reddit.com/u/" + comment.user + "\">" + comment.user + "</a>");
        commentHTML.find('.comment-wrapper').append("<div class=\"reddit-comment-sub\">r/" + comment.subreddit + "</div>");
        commentHTML.find('.comment-wrapper').append("<div class=\"reddit-comment-content\">" + (decodeHTML(comment.userContent)) + "</div>");
        commentHTML.find('.comment-wrapper').append('<div class="reddit-comment-source"></div>');
        commentHTML.find('.reddit-comment-source').append("<a href=\"" + comment.url + "\">See Original</a>");
        commentHTML.find('.comment-wrapper').append('<div class="reddit-comment-more"></div>');
        commentHTML.find('.reddit-comment-more').append("<a href=\"" + comment.threadUrl + "\">More From This Thread</a>");
        if (index === 0) {
          populateComments(comment.children, 1);
        }
      }
      if (verbose) {
        return console.log('populateComments completed');
      }
    };
    suggestPost = function() {
      return $('#reddit-comments-card').append("<div class=\"empty-message\">We couldn\'t find anything! Maybe you should <a href=\"https://www.reddit.com/r/videos/submit?url=" + (encodeURI(window.location.href)) + "\">submit to r/videos</a></div>");
    };
    setupUpdoots = function() {
      $('.reddit-comment-updoot .up').on("click", function() {
        $(this).toggleClass('active');
        return $(this).parent().find('.down').removeClass('active');
      });
      return $('.reddit-comment-updoot .down').on("click", function() {
        $(this).toggleClass('active');
        return $(this).parent().find('.up').removeClass('active');
      });
    };
    drawToScreen = function(comments) {
      if (verbose) {
        console.log('drawToScreen started...');
      }
      pageSetup();
      selectorSetup();
      if (verbose) {
        console.log("We've found " + comments.length + " comments");
      }
      if (comments.length > 0) {
        populateComments(comments, 0);
      }
      if (comments.length === 0) {
        suggestPost();
      }
      return setupUpdoots();
    };
    return drawToScreen(comments);
  };

}).call(this);
